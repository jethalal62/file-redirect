<script type="module">
  import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";
  
  const supabase = createClient(
    "https://itrvfwwxjoedvrmhkkvi.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  );

  const urlParams = new URLSearchParams(window.location.search);
  const movieId = urlParams.get('id');

  async function fetchMovieData() {
    try {
      let { data, error } = await supabase
        .from('movies')
        .select('*')
        .eq('id', movieId)
        .single();
      
      if (error || !data) {
        console.error("Movie not found:", error);
        document.body.innerHTML = "<h1>Movie not found</h1>";
        return;
      }

      console.log("Fetched Data:", data);  // Debugging

      // Update button links (force refresh)
      document.getElementById('streamButton').href = data.streamhg_url || "#";
      document.getElementById('downloadButton').href = data.cloud_download_url || "#";
      document.getElementById('telegramButton').href = data.telegram_url || "#";
    } catch (err) {
      console.error("Fetch Error:", err);
    }
  }

  fetchMovieData();

  // Enable Realtime updates
  supabase.channel('movies_realtime')
    .on('postgres_changes', { event: '*', schema: 'public', table: 'movies' }, (payload) => {
      console.log("Database updated:", payload);
      fetchMovieData();
    })
    .subscribe();
</script>
