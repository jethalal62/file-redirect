<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MovieHub</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* Basic Reset */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #1a1a1a; color: white; font-family: Arial, sans-serif; }
        
        /* Debug Console (Visible by default) */
        #debug-console {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #000;
            color: #00ff00;
            padding: 10px;
            border-top: 2px solid #00ff00;
            font-family: monospace;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- Content will be injected here -->
    </div>

    <div id="debug-console">
        [DEBUG] Initializing application...
    </div>

    <script>
        // ======== CONFIGURATION ======== //
        const SUPABASE_URL = 'https://itrvfwwxjoedvrmhkkvi.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml0cnZmd3d4am9lZHZybWhra3ZpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDA1NzIwMTYsImV4cCI6MjA1NjE0ODAxNn0.-XZZTiEBhy75cIWo_IpcYFWET7ckSfu0b6l4-ev0S0s';
        // =============================== //

        // Debugging System
        function debugLog(message) {
            const console = document.getElementById('debug-console');
            console.innerHTML += `<br>[DEBUG] ${new Date().toLocaleTimeString()}: ${message}`;
            console.scrollTop = console.scrollHeight;
        }

        // Error Handler
        function showError(message) {
            debugLog(`ERROR: ${message}`);
            document.getElementById('app').innerHTML = `
                <div style="padding: 20px; text-align: center;">
                    <h2 style="color: red;">⚠️ Error</h2>
                    <p>${message}</p>
                    <button onclick="location.reload()" style="margin-top: 10px; padding: 10px;">
                        Reload Page
                    </button>
                </div>
            `;
        }

        // Main Application
        async function initializeApp() {
            try {
                // 1. Verify Supabase Connection
                debugLog('Checking Supabase credentials...');
                if (!SUPABASE_URL.includes('supabase.co') || !SUPABASE_KEY.startsWith('ey')) {
                    throw new Error('Invalid Supabase credentials');
                }

                // 2. Initialize Supabase Client
                debugLog('Initializing Supabase client...');
                window.supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                
                // 3. Test Connection
                debugLog('Testing database connection...');
                const { error } = await supabase
                    .from('movies')
                    .select('*')
                    .limit(1);

                if (error) throw new Error('Database connection failed');

                // 4. Get Movie ID
                debugLog('Checking URL parameters...');
                const urlParams = new URLSearchParams(window.location.search);
                const movieId = urlParams.get('id') || 'default_movie_id';

                // 5. Load Movie Data
                debugLog(`Fetching movie data for ID: ${movieId}`);
                const { data: movie, error: fetchError } = await supabase
                    .from('movies')
                    .select('*')
                    .eq('id', movieId)
                    .single();

                if (fetchError) throw new Error('Movie not found');
                if (!movie) throw new Error('Invalid movie data');

                // 6. Render Content
                debugLog('Rendering content...');
                document.getElementById('app').innerHTML = `
                    <div style="max-width: 800px; margin: 20px auto;">
                        <h1>${movie.title}</h1>
                        <img src="${movie.poster_url}" style="max-width: 300px; margin: 20px 0;">
                        <div style="margin: 20px 0;">
                            <button onclick="window.open('${movie.streamhg_url}', '_blank')" 
                                    style="padding: 10px 20px; margin: 5px;">
                                Watch Now
                            </button>
                            <button onclick="window.open('${movie.cloud_download_url}', '_blank')" 
                                    style="padding: 10px 20px; margin: 5px;">
                                Download
                            </button>
                        </div>
                    </div>
                `;

                debugLog('Application initialized successfully');

            } catch (error) {
                showError(error.message);
            }
        }

        // Start Application
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>
