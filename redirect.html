<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Redirect Page</title>
</head>
<body>
  <h1>Loading...</h1>

  <!-- Buttons for actions -->
  <a id="streamButton" href="#" style="display:none;">Watch Online</a>
  <a id="downloadButton" href="#" style="display:none;">Cloud Download</a>
  <a id="telegramButton" href="#" style="display:none;">Telegram Download</a>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

    const supabaseUrl = 'https://itrvfwwxjoedvrmhkkvi.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml0cnZmd3d4am9lZHZybWhra3ZpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDA1NzIwMTYsImV4cCI6MjA1NjE0ODAxNn0.-XZZTiEBhy75cIWo_IpcYFWET7ckSfu0b6l4-ev0S0s';  // Replace with actual key
    const supabase = createClient(supabaseUrl, supabaseKey);

    const urlParams = new URLSearchParams(window.location.search);
    const movieId = urlParams.get('id');

    async function fetchMovieData() {
      try {
        const { data, error } = await supabase
          .from('movies')  // Table name
          .select('streamhg_url, cloud_download_url, telegram_url')
          .eq('id', movieId)
          .single();

        if (error || !data) {
          document.body.innerHTML = '<h1>Movie not found.</h1>';
          return;
        }

        // Set correct links for buttons
        document.getElementById('streamButton').href = data.streamhg_url;
        document.getElementById('downloadButton').href = data.cloud_download_url;
        document.getElementById('telegramButton').href = data.telegram_url;

        // Make buttons visible
        document.getElementById('streamButton').style.display = 'block';
        document.getElementById('downloadButton').style.display = 'block';
        document.getElementById('telegramButton').style.display = 'block';

        document.body.innerHTML = '<h1>Select an option below:</h1>';  // Update page content

      } catch (err) {
        console.error('Error fetching movie:', err);
        document.body.innerHTML = '<h1>Error fetching movie data.</h1>';
      }
    }

    fetchMovieData();

    // Listen for changes in the database
    supabase.channel('movies_realtime')
      .on('postgres_changes', { event: '*', schema: 'public', table: 'movies' }, fetchMovieData)
      .subscribe();
  </script>
</body>
</html>
