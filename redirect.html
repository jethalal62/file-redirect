<script>
    // ======== CONFIGURATION ======== //
    const SUPABASE_URL = 'https://itrvfwwxjoedvrmhkkvi.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml0cnZmd3d4am9lZHZybWhra3ZpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDA1NzIwMTYsImV4cCI6MjA1NjE0ODAxNn0.-XZZTiEBhy75cIWo_IpcYFWET7ckSfu0b6l4-ev0S0s';
    // =============================== //

    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    document.addEventListener('DOMContentLoaded', async () => {
        try {
            const urlParams = new URLSearchParams(window.location.search);
            const movieId = urlParams.get('id');

            // 1. Validate Movie ID
            if (!movieId) throw new Error('Missing movie ID in URL');

            // 2. Fetch Movie Data
            const { data: movie, error } = await supabaseClient
                .from('movies')
                .select('*')
                .eq('id', movieId);

            // 3. Handle Supabase Error
            if (error) throw error;
            
            // 4. Check Results Length
            if (!movie || movie.length === 0) {
                throw new Error('Movie not found');
            }
            
            if (movie.length > 1) {
                throw new Error('Multiple movies found - Database error');
            }

            // 5. Get Single Movie
            const movieData = movie[0];

            /* ... rest of your UI update code ... */

        } catch (error) {
            // Special Handling for Supabase Single() Error
            if (error.message.includes('JSON object requested, multiple')) {
                error.message = 'Database contains duplicate movie IDs';
            }
            
            // Update error display
            document.querySelector('.error-message').textContent = error.message;
        }
    });
</script>
