<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MovieHub - DEBUG MODE</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* Debug Styles */
        body { background: #1a1a1a; color: white; font-family: Arial; }
        #debug-console {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: black;
            color: lime;
            padding: 10px;
            font-family: monospace;
            z-index: 9999;
        }
    </style>
</head>
<body>
    <div id="content"></div>
    <div id="debug-console"></div>

    <script>
        // ========== CONFIGURATION ========== //
        const SUPABASE_URL = 'https://itrvfwwxjoedvrmhkkvi.supabase.co'; // REPLACE THIS
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml0cnZmd3d4am9lZHZybWhra3ZpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDA1NzIwMTYsImV4cCI6MjA1NjE0ODAxNn0.-XZZTiEBhy75cIWo_IpcYFWET7ckSfu0b6l4-ev0S0s'; // REPLACE THIS
        // =================================== //

        // Debugging System
        function debugLog(message) {
            const consoleDiv = document.getElementById('debug-console');
            consoleDiv.innerHTML += `[DEBUG] ${new Date().toLocaleTimeString()}: ${message}<br>`;
        }

        // 1. Validate Supabase Credentials
        debugLog('Initializing...');
        if (!SUPABASE_URL.includes('supabase.co') || !SUPABASE_KEY.startsWith('ey')) {
            debugLog('ERROR: Invalid Supabase credentials');
            document.body.innerHTML = `<h1 style="color:red">Invalid Supabase Configuration</h1>`;
            throw new Error('Supabase credentials not configured');
        }

        // 2. Initialize Supabase
        debugLog('Connecting to Supabase...');
        const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // 3. Check URL Parameters
        const urlParams = new URLSearchParams(window.location.search);
        const movieId = urlParams.get('id');
        debugLog(`Movie ID from URL: ${movieId || 'NOT FOUND'}`);

        // 4. Fetch Movie Data
        async function loadMovie() {
            try {
                if (!movieId) {
                    throw new Error('Add ?id=MOVIE_ID to URL');
                }

                debugLog(`Fetching movie ${movieId}...`);
                const { data, error } = await supabase
                    .from('movies')
                    .select('*')
                    .eq('id', movieId);

                if (error) {
                    debugLog(`Supabase Error: ${error.message}`);
                    throw error;
                }

                if (!data || data.length === 0) {
                    throw new Error('Movie not found in database');
                }

                if (data.length > 1) {
                    throw new Error('Database contains duplicate IDs');
                }

                // 5. Show Movie Content
                const movie = data[0];
                debugLog('Movie loaded successfully');
                document.getElementById('content').innerHTML = `
                    <h1>${movie.title}</h1>
                    <img src="${movie.poster_url}" style="max-width:300px">
                    <div>
                        <a href="${movie.telegram_url}" target="_blank">Telegram</a>
                        <a href="${movie.cloud_download_url}" target="_blank">Download</a>
                        <a href="${movie.streamhg_url}" target="_blank">Stream</a>
                    </div>
                `;

            } catch (error) {
                debugLog(`FATAL ERROR: ${error.message}`);
                document.body.innerHTML = `
                    <div style="padding:20px; text-align:center;">
                        <h1 style="color:red">⚠️ ${error.message}</h1>
                        <p>Check these:</p>
                        <ul style="text-align:left; display:inline-block;">
                            <li>URL has ?id= parameter</li>
                            <li>Movie exists in database</li>
                            <li>Supabase credentials are valid</li>
                        </ul>
                    </div>
                `;
            }
        }

        // Start the app
        loadMovie();
    </script>
</body>
</html>
