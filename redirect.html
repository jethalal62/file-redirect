<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <title>Redirecting...</title>
    <style>
        .loading {
            padding: 20px;
            font-size: 1.2em;
        }
        .error {
            color: red;
        }
    </style>
</head>
<body>
    <div id="status" class="loading">⏳ Loading movie...</div>

    <script type="module">
        // Replace with your actual credentials
        const SUPABASE_URL = "https://itrvfwwxjoedvrmhkkvi.supabase.co";
        const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml0cnZmd3d4am9lZHZybWhra3ZpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDA1NzIwMTYsImV4cCI6MjA1NjE0ODAxNn0.-XZZTiEBhy75cIWo_IpcYFWET7ckSfu0b6l4-ev0S0s";
        
        import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";
        const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

        // Get movie ID from URL
        const urlParams = new URLSearchParams(window.location.search);
        const movieId = urlParams.get('id');
        console.log('Movie ID from URL:', movieId);

        async function redirectToMovie() {
            try {
                const { data, error } = await supabase
                    .from('movies')
                    .select('streamhg_url')
                    .eq('id', movieId)
                    .single();

                if (error || !data?.streamhg_url) {
                    throw new Error('Movie not found');
                }

                // Add cache-buster to URL
                const finalUrl = `${data.streamhg_url}?t=${Date.now()}`;
                console.log('Redirecting to:', finalUrl);
                
                // Immediate redirect
                window.location.href = finalUrl;

            } catch (err) {
                console.error('Redirect failed:', err);
                document.getElementById('status').className = 'error';
                document.getElementById('status').innerHTML = 
                    `❌ Error: ${err.message || 'Failed to load movie'}`;
            }
        }

        // Start the process
        redirectToMovie();
    </script>
</body>
</html>
