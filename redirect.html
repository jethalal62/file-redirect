<script>
    // 1. Initialize Supabase FIRST (Critical Fix)
    const SUPABASE_URL = 'https://your-project.supabase.co';
    const SUPABASE_KEY = 'your-anon-key';
    const supabase = supabase.createClient( 'https://itrvfwwxjoedvrmhkkvi.supabase.co' , 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml0cnZmd3d4am9lZHZybWhra3ZpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDA1NzIwMTYsImV4cCI6MjA1NjE0ODAxNn0.-XZZTiEBhy75cIWo_IpcYFWET7ckSfu0b6l4-ev0S0s');

    document.addEventListener('DOMContentLoaded', async () => {
        try {
            // 2. Get Movie ID
            const urlParams = new URLSearchParams(window.location.search);
            const movieId = urlParams.get('id');

            // 3. Fetch Movie Data
            const { data: movie, error } = await supabase
                .from('movies')
                .select('*')
                .eq('id', movieId)
                .single();

            if (error) throw error;

            // 4. Update UI Elements
            document.getElementById('movieTitle').textContent = movie.title;
            document.getElementById('moviePoster').src = movie.poster_url;
            document.getElementById('movieGenre').textContent = movie.genre;
            document.getElementById('movieYear').textContent = movie.release_year;

            // 5. Set Button Actions (Mobile Optimized)
            const buttons = {
                telegramBtn: movie.telegram_url,
                cloudBtn: movie.cloud_download_url,
                streamBtn: movie.streamhg_url
            };

            Object.entries(buttons).forEach(([id, url]) => {
                const btn = document.getElementById(id);
                if (btn && url) {
                    btn.href = url;
                    btn.onclick = (e) => {
                        if (!url) e.preventDefault();
                        window.open(url, '_blank');
                    };
                }
            });

        } catch (error) {
            console.error('Error:', error);
            document.body.innerHTML = `
                <div class="container" style="text-align: center; padding: 2rem;">
                    <h2 style="color: #ff4757;">⚠️ Error Loading Movie</h2>
                    <p>${error.message}</p>
                    <button onclick="location.reload()" 
                            style="margin-top: 1rem; padding: 12px 24px;
                            background: #1e90ff; color: white; border: none;
                            border-radius: 25px; cursor: pointer;">
                        Try Again
                    </button>
                </div>
            `;
        }
    });
</script>
