<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Redirect Page</title>
</head>
<body>
  <h1>Loading...</h1>
  <script type="module">
    // Import the Supabase client
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

    // Initialize Supabase client with your credentials
    const supabaseUrl = 'https://itrvfwwxjoedvrmhkkvi.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml0cnZmd3d4am9lZHZybWhra3ZpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDA1NzIwMTYsImV4cCI6MjA1NjE0ODAxNn0.-XZZTiEBhy75cIWo_IpcYFWET7ckSfu0b6l4-ev0S0s'; // Replace with your actual API key
    const supabase = createClient(supabaseUrl, supabaseKey);

    // Extract the 'id' parameter from the URL
    const urlParams = new URLSearchParams(window.location.search);
    const movieId = urlParams.get('id');

    // Function to fetch movie data from Supabase
    async function fetchMovieData() {
      try {
        const { data, error } = await supabase
          .from('movies') // Ensure this matches your table name
          .select('*')
          .eq('id', movieId)
          .single();

        if (error) throw error;

        if (data) {
          // Redirect to the stream URL if available
          if (data.streamhg_url) {
            window.location.href = data.streamhg_url;
          } else {
            document.body.innerHTML = '<h1>Stream URL not found for this movie.</h1>';
          }
        } else {
          document.body.innerHTML = '<h1>Movie not found.</h1>';
        }
      } catch (error) {
        console.error('Error fetching movie data:', error);
        document.body.innerHTML = '<h1>An error occurred while fetching movie data.</h1>';
      }
    }

    // Fetch movie data on page load
    fetchMovieData();
  </script>
</body>
</html>
