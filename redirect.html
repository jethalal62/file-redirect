<script type="module">
  // Initialize Supabase
  import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";
  const supabase = createClient("https://itrvfwwxjoedvrmhkkvi.supabase.co", "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml0cnZmd3d4am9lZHZybWhra3ZpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDA1NzIwMTYsImV4cCI6MjA1NjE0ODAxNn0.-XZZTiEBhy75cIWo_IpcYFWET7ckSfu0b6l4-ev0S0s");

  // Get the movie ID from the URL
  const urlParams = new URLSearchParams(window.location.search);
  const movieId = urlParams.get('id');

  // Function to fetch movie data
  async function fetchMovieData() {
    let { data, error } = await supabase
      .from('movies')  // Replace with your table name
      .select('*')
      .eq('id', movieId)
      .single();  // Fetch a single row

    if (error || !data) {
      console.error("Movie not found:", error);
      document.body.innerHTML = "<h1>Movie not found</h1>";
      return;
    }

    // Update the page content with the new movie data
    document.getElementById('streamButton').href = data.streamhg_url;
    document.getElementById('downloadButton').href = data.cloud_download_url;
    document.getElementById('telegramButton').href = data.telegram_url;
  }

  // Fetch movie data on page load
  fetchMovieData();

  // Enable Realtime updates
  supabase.channel('movies_realtime')
    .on('postgres_changes', { event: '*', schema: 'public', table: 'movies' }, (payload) => {
      console.log("Database updated:", payload);
      fetchMovieData();  // Refresh data when changes occur
    })
    .subscribe();
</script>
