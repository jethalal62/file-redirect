<script>
    document.addEventListener('DOMContentLoaded', async () => {
        // Initialize Supabase with PROPER CREDENTIALS
        const supabase = supabase.createClient(
            'https://itrvfwwxjoedvrmhkkvi.supabase.co',  // REPLACE WITH YOUR SUPABASE URL
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml0cnZmd3d4am9lZHZybWhra3ZpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDA1NzIwMTYsImV4cCI6MjA1NjE0ODAxNn0.-XZZTiEBhy75cIWo_IpcYFWET7ckSfu0b6l4-ev0S0s' // REPLACE WITH YOUR ANON KEY
        );

        // Get movie ID from URL
        const urlParams = new URLSearchParams(window.location.search);
        const movieId = urlParams.get('id');

        // Add temporary click handlers
        document.querySelectorAll('.btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                if (btn.href === '#') {
                    e.preventDefault();
                    alert('Content loading... Please try again in a moment');
                }
            });
        });

        try {
            // Fetch movie data
            const { data: movie, error } = await supabase
                .from('movies')
                .select('*')
                .eq('id', movieId)
                .single();

            if (error || !movie) throw error;

            // Update UI
            document.getElementById('movieTitle').textContent = movie.title;
            document.getElementById('movieGenre').textContent = movie.genre;
            document.getElementById('movieYear').textContent = movie.release_year;
            document.getElementById('moviePoster').src = movie.poster_url;

            // Set button actions PROPERLY
            const setHref = (elementId, url) => {
                const element = document.getElementById(elementId);
                if (element && url) {
                    element.href = url;
                    element.target = '_blank';  // Open in new tab
                }
            };

            setHref('telegramBtn', movie.telegram_url);
            setHref('cloudBtn', movie.cloud_download_url);
            setHref('streamBtn', movie.streamhg_url);

        } catch (error) {
            console.error('Error:', error);
            document.body.innerHTML = `
                <div class="container" style="text-align: center; padding: 5rem;">
                    <h2 style="color: var(--primary); margin-bottom: 1rem;">⚠️ Error Loading Movie</h2>
                    <p style="margin-bottom: 2rem;">${error.message}</p>
                    <a href="/" style="color: var(--accent); text-decoration: underline;">
                        Return to Homepage
                    </a>
                </div>
            `;
        }
    });
</script>
